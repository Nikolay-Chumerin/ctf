// Copyright 2021 drNoOne

#include <stdio.h>

unsigned char rom[] = {
    0b10111011, 0b01010101, 0b10101011, 0b11000101, 0b10111001, /* 000..004 */
    0b10011101, 0b11001001, 0b01101001, 0b10111011, 0b00110111, /* 005..009 */
    0b11011001, 0b11001101, 0b00100001, 0b10110011, 0b11001111, /* 010..014 */
    0b11001111, 0b10011111, 0b00001001, 0b10110101, 0b00111101, /* 015..019 */
    0b11101011, 0b01111111, 0b01010111, 0b10100001, 0b11101011, /* 020..024 */
    0b10000111, 0b01100111, 0b00100011, 0b00010111, 0b00100101, /* 025..029 */
    0b11010001, 0b00011011, 0b00001000, 0b01100100, 0b01100100, /* 030..034 */
    0b00110101, 0b10010001, 0b01100100, 0b11100111, 0b10100000, /* 035..039 */
    0b00000110, 0b10101010, 0b11011101, 0b01110101, 0b00010111, /* 040..044 */
    0b10011101, 0b01101101, 0b01011100, 0b01011110, 0b00011001, /* 045..049 */
    0b11111101, 0b11101001, 0b00001100, 0b11111001, 0b10110100, /* 050..054 */
    0b10000011, 0b10000110, 0b00100010, 0b01000010, 0b00011110, /* 055..059 */
    0b01010111, 0b10100001, 0b00101000, 0b01100010, 0b11111010, /* 060..064 */
    0b01111011, 0b00011011, 0b10111010, 0b00011110, 0b10110100, /* 065..069 */
    0b10110011, 0b01011000, 0b11000110, 0b11110011, 0b10001100, /* 070..074 */
    0b10010000, 0b00111011, 0b10111010, 0b00011001, 0b01101110, /* 075..079 */
    0b11001110, 0b11011111, 0b11110001, 0b00100101, 0b10001101, /* 080..084 */
    0b01000000, 0b10000000, 0b01110000, 0b11100000, 0b01001101, /* 085..089 */
    0b00011100, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 090..094 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 095..099 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 100..104 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 105..109 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 110..114 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 115..119 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 120..124 */
    0b00000000, 0b00000000, 0b00000000, 'C',        'T',        /* 125..129 */
    'F',        '(',        'w',        'r',        'i',        /* 130..134 */
    't',        'e',        '_',        'f',        'l',        /* 135..139 */
    'a',        'g',        '_',        'h',        'e',        /* 140..144 */
    'r',        'e',        '_',        'p',        'l',        /* 145..149 */
    'e',        'a',        's',        'e',        ')',        /* 150..154 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 155..159 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 160..164 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 165..169 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 170..174 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 175..179 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 180..184 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 185..189 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 190..194 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 195..199 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 200..204 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 205..209 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 210..214 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 215..219 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 220..224 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 225..229 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 230..234 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 235..239 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 240..244 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 245..249 */
    0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, /* 250..254 */
    0b00000000                                                  /* 255 */
};

unsigned char A, B, C, I, L, M, N, O, P, Q, R, X, Y, Z;
signed char S;
char include_stack[32];

int main() {
  puts("Enter flag:");
  unsigned char buffer[256];
  gets(buffer);
  unsigned char* src = &buffer[0];
  unsigned char* dst = &rom[128];
  while (*src && *src != '\n') *dst++ = *src++;

  S = 0;
  L = 0; /* include level */

_include:
  if (L > 12) {
    if (S == 0) {
      S = 24;
    }

    if (S == 1) {
      ++S;
      R = ~R;
    }

    if (S == 2) {
      ++S;
      Z = 1;
    }

    if (S == 3) {
      ++S;
      R += Z;
    }

    if (S == 4) {
      ++S;
      R += Z;
    }

    if (S == 5) {
      ++S;
      if (R == 0) S = 38;
    }
    if (S == 6) {
      ++S;
      R += Z;
    }

    if (S == 7) {
      ++S;
      if (R == 0) S = 59;
    }

    if (S == 8) {
      ++S;
      R += Z;
    }

    if (S == 9) {
      ++S;
      if (R == 0) S = 59;
    }

    if (S == 10) {
      ++S;
      puts("BUG");
    }

    if (S == 11) {
      S = -1;
    }

    if (S == 12) {
      ++S;
      X = 1;
    }

    if (S == 13) {
      ++S;
      Y = 0;
    }

    if (S == 14) {
      ++S;
      if (X == 0) S = 22;
    }

    if (S == 15) {
      ++S;
      Z = X;
    }

    if (S == 16) {
      ++S;
      Z &= B;
    }

    if (S == 17) {
      ++S;
      if (Z == 0) S = 19;
    }

    if (S == 18) {
      ++S;
      Y += A;
    }

    if (S == 19) {
      ++S;
      X += X;
    }

    if (S == 20) {
      ++S;
      A += A;
    }

    if (S == 21) {
      S = 14;
    }

    if (S == 22) {
      ++S;
      A = Y;
    }

    if (S == 23) {
      S = 1;
    }

    if (S == 24) {
      ++S;
      I = 0;
    }

    if (S == 25) {
      ++S;
      M = 0;
    }

    if (S == 26) {
      ++S;
      N = 1;
    }

    if (S == 27) {
      ++S;
      P = 0;
    }

    if (S == 28) {
      ++S;
      Q = 0;
    }

    if (S == 29) {
      ++S;
      B = 0b11100101;
    }

    if (S == 30) {
      ++S;
      B += I;
    }

    if (S == 31) {
      ++S;
      if (B == 0) S = 56;
    }

    if (S == 32) {
      ++S;
      B = 0b10000000;
    }

    if (S == 33) {
      ++S;
      B += I;
    }

    if (S == 34) {
      ++S;
      A = rom[B];
    }

    if (S == 35) {
      ++S;
      B = rom[I];
    }

    if (S == 36) {
      ++S;
      R = 1;
    }

    if (S == 37) {
      S = 12;
    }

    if (S == 38) {
      ++S;
      O = M;
    }

    if (S == 39) {
      ++S;
      O += N;
    }

    if (S == 40) {
      ++S;
      M = N;
    }

    if (S == 41) {
      ++S;
      N = O;
    }

    if (S == 42) {
      ++S;
      A += M;
    }

    if (S == 43) {
      ++S;
      B = 0b00100000;
    }

    if (S == 44) {
      ++S;
      B += I;
    }

    if (S == 45) {
      ++S;
      C = rom[B];
    }

    if (S == 46) {
      ++S;
      A ^= C;
    }

    if (S == 47) {
      ++S;
      P += A;
    }

    if (S == 48) {
      ++S;
      B = 0b01000000;
    }

    if (S == 49) {
      ++S;
      B += I;
    }

    if (S == 50) {
      ++S;
      A = rom[B];
    }

    if (S == 51) {
      ++S;
      A ^= P;
    }

    if (S == 52) {
      ++S;
      Q |= A;
    }

    if (S == 53) {
      ++S;
      A = 1;
    }

    if (S == 54) {
      ++S;
      I += A;
    }

    if (S == 55) {
      S = 29;
    }

    if (S == 56) {
      ++S;
      if (Q == 0) S = 58;  // SUCCESS
    }

    if (S == 57) {
      ++S;
      puts("INVALID FLAG");
      return -1;
    }

    if (S == 58) {
      S = -1;
    }
  } else { /* else for (L > 12) */
    if (S != -1) {
      include_stack[L++] = 1;
      goto _include;
    }
  _after_include1:

    if (S != -1) {
      include_stack[L++] = 2;
      goto _include;
    }
  } /* L <= 12  */

_after_include2:

  if (L == 0) {
    if (S != -1) {
      puts("INVALID FLAG");
      return 1;
    } else {
      puts("VALID FLAG");
      return 0;
    }
  } else {
    if (include_stack[--L] == 1) {
      goto _after_include1;
    } else {
      goto _after_include2;
    }
  } /* (L == 0) */

} /* main() */
